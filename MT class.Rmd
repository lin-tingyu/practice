---
title: "MT class"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r}
library(lubridate)
#時間處理的相關函數
Sys.timezone()
# 顯示目前電腦時區設定
T <- ymd_hms("2019-03-18 14:04:00", tz="Asia/Taipei")
ET<- with_tz(T,tzone="Europe/Lisbon")
# 轉成歐洲時間
as.integer(ymd("2019-03-11"))
#和時間原點“1970-01-01”差多幾天－－－17966天
Sys.Date()
#给出當前日期
today <- Sys.Date()
dob <- as.Date("1956-10-12")
difftime(today, dob, units="weeks")
#當前日期和1956-10-12差幾週
```
～～～～～～～～～～～～第五章～～～～～～～～～～～～～～～～～～
數值判別
```{r}
a <- c(1,5,8)
b <- c(5,8)
a %in% b
#a是否存在字啊b裡面
is.na(a)
#a是否有NA(not available)
```
字串判別
```{r}
c <- c("台北市","新北市","高雄市")
d <- c("台北市","新北市")
e <- c("女","男","女")
#以下功能類似 str_detect
#練習
# 第一題
(c %in% d) & (e=="女")
# 第二題
(c %in% d) | (e=="女")
# 第三題
xor(c %in% d, e=="女")
#(T T F)  (T F T)-> (F T T )
which(e=="女")
#可以知道那幾筆資料是true
```
～～～～～～～～例題1～～～～～～～～
題目
```{r}
library(readr)
exData2 <- read_csv("https://raw.githubusercontent.com/tpemartin/github-data/master/exData2.csv")
date <- as.character(exData2$期間)
currency <- exData2$幣別
exchangeRate <- exData2$匯率
# "$" 將資料某個部分提取
```
答案
```{r}
date2<- as.Date(date)
#將上面擷取的時間轉換成r看得懂的形式
date3<- as.double(date2)
#date2的時間和1970-01-01相比差幾天
####為什麼又由正轉負？？？？
which(date3<=0)
which(currency=="歐元USD/EUR")
#前705皆為"歐元USD/EUR"
ER1<-na.omit(exchangeRate)
#去除exchangeRate中的na，ER1和exchangeRate數目相減的na數
```
筆記
```{r}
as.integer(ymd("2019-03-11"))
#和時間原點“1970-01-01”差多幾天－－－17966天
Sys.Date()
#给出當前日期
today <- Sys.Date()
dob <- as.Date("1956-10-12")
difftime(today, dob, units="weeks")
#當前日期和1956-10-12差幾週
```
～～～～～～～～例題2～～～～～～～～
題目
```{r}
library(readr)
transcriptDataFinal <- read_csv("https://raw.githubusercontent.com/tpemartin/github-data/master/transcriptDataFinal.csv")
courseType <- transcriptDataFinal$`必選修類別（必∕選∕通）`
major <- transcriptDataFinal$學系
studentID <- transcriptDataFinal$學號
grade <- transcriptDataFinal$學期成績
```
答案
```{r}
which(major=="經濟學系")
#（答）16926人是經濟學系
aaa<-transcriptDataFinal[studentID=="5bdS6977b",]
#在此也可以寫成   aaa<-transcriptDataFinal[transcriptDataFinal$學號=="5bdS6977b",]
#（答）總共66堂
gradeaaa<-aaa$學期成績
aab<-subset(aaa,gradeaaa>=60)
#????????????????????????????????????????????????????????????????aab<-transcriptDataFinal[studentID=="5bdS6977b",grade>=60]哪裡錯 ???????????????????????????????????????????????????????????????
#不能使用aab<-subset(aaa,grade>=60)，因為grade向量不為aaa資料所創
#（答）全部都及格
aac<-transcriptDataFinal[major=="經濟學系"&courseType=="選",]
#（答）6261 筆
aad<-transcriptDataFinal[major=="經濟學系"&courseType=="必",]
gradeaad<-aad$學期成績
aae<-subset(aad,gradeaad<=59)
#（答）496/9005=0.055
```
筆記
```{r}
f<- matrix(c(1:20),nrow=5,ncol=4,
dimnames = list(c("a1", "a2","a3","b1","b2"),
     c("c1", "c2","d1", "d2")))
g<-f[3,]
#這只能找第幾row的資料，不符合題目要求
h<-transcriptDataFinal[substr(major,1,4)=="法律學系",]
#將學系前四個字有"法律學系"選出來
```
字串的操作package
```{r}
library(stringr)
```
字串選取
```{r}
c <- c("台北市","新北市","高雄市")
str_subset(c,"台北市")
#功能類似 %in%
str_detect(c,"台北市")
#功能類似 %in%
```
字串合成
```{r}
month <- c("3","4","2")
day <- c("11","5","7")
#要如何將上面兩個的字串組合成一個？有三種方法

#第一種
str_c(month,c("月"),day,c("日"))
#第二種
str_c(month,"月",day,"日")
#第三種（將四個字串合成一個）
  char1 <- c("月","月","月")
  char2 <- c("日","日","日")
str_c(month,char1,day,char2)

#也可以加其他符號
str_c(month,day, sep="-")
```
字串拆解
```{r}
dates <- c("3-11", "4-5",  "2-7")
str_split(dates,"-")
```
字串取代
```{r}
str_replace(dates,"-","/")
str_replace_all(dates,"-","/")
#只能將character換character
```
練習題－1
```{r}
library(readr)
filmVotingData <- read_csv("https://raw.githubusercontent.com/tpemartin/github-data/master/%E7%AC%AC%E4%B8%89%E5%B1%86%E7%B6%93%E6%BF%9F%E6%92%AD%E5%AE%A2%E7%AB%B6%E8%B3%BD%E5%8F%83%E8%B3%BD%E4%BD%9C%E5%93%81%E6%8A%95%E7%A5%A8%E7%B5%90%E6%9E%9C%E6%A8%A3%E6%9C%AC%20-%20Sheet1.csv")
birthday<-filmVotingData$`出生西元年月日（驗證本人用）`
birthday1<-str_split(birthday,"/")
#???????????????????????????????????????????????????????????????程式碼最後如果是"\","/"很容易變綠色   ???????????????????????????????????????????????????????????????
生日年<-substring(birthday1,1,4)
#將1～4字元分隔出來
生日年1<-生日年[substr(生日年,1,2)=="19"]
# 將生日是“19”開頭的加入aag（去掉“h124903962”）
生日月<-substring(birthday1,5,6)
生日日<-substring(birthday1,7,8)
生日<-str_c(生日年1,"年",生日月,"月",生日日,"日")
生日[1:2]
#[1:2]只顯示前兩個
```
練習題－2
```{r}
library(base)
民國年月<-c("099/01","099/02","099/03")
年<-as.numeric(substring(民國年月,1,3))
西元年<-as.character(年+1912)
月<-substring(民國年月,5,6)
月_去零<-as.character(as.integer(substring(民國年月,5,6)))
西元日期<-str_c(西元年,"年",月_去零,"月")
西元日期[1:2]
```
Practice 1
```{r}
gender <- c("男性", "男性", "女性", "男性", "女性", "男性")
性別<- factor(x = gender, levels = c("男性", "女性"), labels = c("Male", "Female"))
```
Practice 2
```{r}
library(readr)
library(stringr)
library(lubridate)
TyphoonData <- read_csv("https://raw.githubusercontent.com/GaryLKL/course-programming-for-ds-Quiz/master/TyphoonData.csv", col_types = cols(.default = col_character()))
Year<-as.integer(TyphoonData$年份)
#將資料變成“整數列”
民國<-as.character(Year-1911)
str_c("民國",民國,"西元",Year)

發布月<-substring(TyphoonData$發布警報時間,6,7)
```
Practice 3
```{r}
房租月<-sprintf("%02d", seq(from=01,to=12,by=1))
#sprintf("%02d", )指將數值以兩位數方式呈現
房租2018<-str_c("2018","-",房租月,"-","10")
房租2019<-str_c("2019","-",房租月,"-","10")
房租<-ymd(c(房租2018,房租2019))

library(lubridate)
房租星期<-wday(房租)
房租星期
```

```{r}
library(readr)
source <-read_csv("https://raw.githubusercontent.com/GaryLKL/course-programming-for-ds-Quiz/master/AverageSalary.csv")
十年薪資<-tail(source,n=10)
#將資料‘source’前十筆存入‘十年薪資’
營造業薪資<-source$營造業
營造業平均<-mean(營造業薪資)
營造業最大值<-max(營造業薪資)
營造業最小值<-min(營造業薪資)
```
Practice 3筆記
```{r}
p3<-seq(from=01,to=12,length.out=5)
p3_1<-seq(from=01,to=24,along.with=房租月)
#length.out 表示要求只出現5個數值（1～12分5等分）
#along.with 表示要求只出現和“p3_1”一樣多的數值（5個數值）
```
Practice 4
```{r}
library(readr)
TyphoonData <- read_csv("https://raw.githubusercontent.com/GaryLKL/course-programming-for-ds-Quiz/master/TyphoonData.csv")
近臺強度_factor<-as.factor(str_replace_all(TyphoonData$近臺,"---","0"))
最低氣壓_數值<-as.numeric(str_replace_all(TyphoonData$`最低氣壓(hPa)`,"---","0"))
最大風速_數值<-as.numeric(str_replace_all(TyphoonData$`最大風速(m/s)`,"---","0"))
十級風暴風半徑_數值<-as.numeric(str_replace_all(TyphoonData$`10級風暴風半徑(km)`,"---","0"))
七級風暴風半徑_數值<-as.numeric(str_replace_all(TyphoonData$`7級風暴風半徑(km)`,"---","0"))
#將不足的資料用0來代替
資料<-data.frame(近臺強度=近臺強度_factor,最低氣壓=最低氣壓_數值,最大風速=最大風速_數值,七級風暴風半徑=七級風暴風半徑_數值,十級風暴風半徑=十級風暴風半徑_數值)

index1 <- which(TyphoonData$年份 >= 2009) 
#將年份 >= 2009的資料做標記（which可判別T or F，也可以拿來做標記）
近十年<-TyphoonData[index1,]
#列出已做標記的資料
table(近十年$近臺強度)
#用table可以數物件內的所有資料個數

index2 <- TyphoonData$年份 %in% 2009:2018
#和which相同，可以判別T or F的指令，皆有座標記的功能
近十年1<-TyphoonData[index2,]
近十年_近臺強度為中度<-近十年1[近十年1$近臺強度 %in% "中度",]
#再用%in%做一次標記
近十年_近臺強度為中度_max風速<-max(近十年_近臺強度為中度$`最大風速(m/s)`)
近十年_近臺強度為中度_max風速
```
Practice 5
```{r}
library(readr)
IMDBData <- read_csv("https://raw.githubusercontent.com/GaryLKL/course-programming-for-ds-Quiz/master/imdb_movies.csv")
#head(IMDBData)
dim(IMDBData)
#有幾個row和column
ncol(IMDBData)
#有幾個column
nrow(IMDBData)
#有幾個row
dimnames(IMDBData)
#將行列的名字列出
names(IMDBData)
colnames(IMDBData)
#將行的名字列出
summary(IMDBData)

AntMan<-summary(IMDBData[IMDBData$片名=="Ant-Man",])
#名字不能有"-"
table(IMDBData$年份)
最短電影<-IMDBData[min(which(complete.cases(IMDBData$片長))),]
#complete.cases判別是否有na（故可以做標記），na.omit則直接移除na
#complete.cases判別data.frame時，只要有na就會判別 FALSE
nrow(data.frame(table(IMDBData$類型)))
#table轉data.frame時變數會在row
片長分類<-cut(IMDBData$片長,c(0,90,120,150,500),c(1,2,3,4))
#c(0,90,120,150,500)將“片長”用五個數值分四段，分別用c(1,2,3,4)來標記）

```
Practice 6
```{r}
library(readr)
data<- read_csv("https://raw.githubusercontent.com/GaryLKL/course-programming-for-ds-Quiz/master/Yilan.csv")

summary(complete.cases(data))
#complete.cases判別data.frame時，只要有na就會判別 FALSE
nrow(data)
ncol(data)

```

```{r}
鄉鎮市區<-data.frame(鄉鎮市區代碼=data$鄉鎮市區代碼,鄉鎮市區名稱=data$鄉鎮市區名稱)
unique(鄉鎮市區)
#???????????????????????????????????????????????????????????? 用summary和unique ?????????????????????????????????????????????????????????????
```

```{r}
library(dplyr)
#"??mutate_at"可以查mutate_at的package是什麼
data1<- as_tibble(data)
#yiersan<-mutate_at(data,c("縣市代碼","縣市名稱","鄉鎮市區代碼","鄉鎮市區名稱"),)
c("a","b","c","d")
#縣市名稱<-vars(data$縣市名稱)
#鄉鎮市區代碼<-funs(data$鄉鎮市區代碼)
#鄉鎮市區名稱<-parse_factor(data$鄉鎮市區名稱)
library(forcats)
yiersan<-parse_factor(data$縣市代碼,levels = NULL)
yiersan
??as.factor
```

```{r}
a=c("a","b","c")
b=c("a","b","d")
c<-parse_factor(a,levels = b)
```

```{r}
library(stringr)
鄉鎮西元_年_數值<-as.numeric(substr(data$資料時間,1,3))+1911
鄉鎮_月<-substr(data$資料時間,5,6)
鄉鎮西元<-str_c(鄉鎮西元_年_數值,"西元",鄉鎮_月,"月")
```


```{r}
羅東鎮最多人數<-max(data[data$鄉鎮市區名稱=="羅東鎮",]$遊客人數)
羅東鎮最多人數
```

```{r}
七月<-data[substring(data$資料時間,5,6)=="07",]
七月總人數<-sum(七月$遊客人數)
四月<-data[substring(data$資料時間,5,6)=="04",]
四月總人數<-sum(四月$遊客人數)
四月group<-group_by(data$資料時間,a=sum(data$遊客人數))
#"data$資料時間"形式為character，且不能轉成table，而group_by只接受table的資料，所以目前還不知道怎麼不用%>% 寫group_by
data%>% 
  group_by(資料時間) %>% 
  summarise(sum(遊客人數,na.rm=T))
#用group_by的寫法
```
Practice 7
```{r}
library(readr)
library(dplyr)
library(summarytools)
library(lubridate)
library(stringr)
nba_data <- read_csv("https://raw.githubusercontent.com/GaryLKL/course-programming-for-ds-Quiz/master/GSW_Stat.csv")
```

```{r}
#以下為尋找row的的遺失資料，有兩種方式
p7_1<-nba_data[!complete.cases(nba_data),]
#第一種：！為“非”的意思
p7_2<-dfSummary(nba_data)
p7_3<-p7_2$Missing
#第二種：用dfSummary將nba_data的訊息以col來分類（這裡有36col）對他做訊息的整理，再將整理完的訊息做成另一張表（這裡有36row），我們將其中的Missing資訊提出
p7_4<-summary(nba_data)
# 會出現36和數值有關個表
```

～～～～～～～～～～～～第六章～～～～～～～～～～～～～～～～～～
```{r}
a<-matrix(c(1:12),4,3)
宜蘭的鄉鎮<-c("宜蘭市","羅東鎮","蘇澳鎮","頭城鎮","礁溪鄉","壯圍鄉","員山鄉","冬山鄉","五結鄉","三星鄉")
b<-as.data.frame(宜蘭的鄉鎮)
c<-list(c(1:10),a,b)
d<-c[2]
#將list中的第2個列出來
#?????????????????????????????????????????????????????? 怎麼將第二東西（矩陣）中的東西提出 ???????????????????????

```

```{r}
your_github_username <- "tpemartin"
your_practice_reponame <- "107-2-inclass-practice"
library(httr)
library(stringr)
str_replace_all("https://api.github.com/repos/:owner/:repo/commits") -> commitCheckStatement
commitCheck <- content(GET(commitCheckStatement))
commitCheck 
```

```{r}
library(jsonlite)
library(RCurl)
a <- fromJSON(getURL("https://api.github.com/repos/:owner/:repo/commits"))
```

```{r}
library(XML)
a <- xmlParse("https://api.github.com/repos/:owner/:repo/commits")
```

```{r}
a <- url("https://api.github.com/repos/:owner/:repo/commits")
a
```







